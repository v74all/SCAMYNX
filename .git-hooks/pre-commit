#!/bin/bash

# SCAMYNX - Pre-commit Security Check Script
# This script checks for sensitive data before committing

echo "üîç Running pre-commit security checks..."

# Check for API keys in staged files
if git diff --cached --name-only | xargs grep -i "AIzaSy\|sk_\|pk_\|api_key.*=.*[a-zA-Z0-9]" 2>/dev/null; then
    echo "‚ùå ERROR: Found potential API keys in staged files!"
    echo "Please remove them before committing."
    exit 1
fi

# Check for secrets.properties
if git diff --cached --name-only | grep -q "secrets.properties"; then
    echo "‚ùå ERROR: Attempting to commit secrets.properties!"
    echo "This file should never be committed."
    exit 1
fi

# Check for common password patterns
if git diff --cached | grep -i "password.*=.*[a-zA-Z0-9]" 2>/dev/null; then
    echo "‚ö†Ô∏è  WARNING: Found potential password in changes."
    echo "Make sure this is not a real password!"
    read -p "Continue? (y/N) " -n 1 -r
    echo
    if [[ ! $REPLY =~ ^[Yy]$ ]]; then
        exit 1
    fi
fi

echo "‚úÖ Security checks passed!"
exit 0
